<!DOCTYPE html>
<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://proj.ruppin.ac.il/igroup9/test2/tar2/client%20side%20Hw1/Scripts/ajaxCalls.js"></script>

    <link rel="stylesheet" href="../Css/Form.css" />
    <script>
        $(document).ready(function () {
          $("LogInForm").submit(function (e) {
            e.preventDefault();
            // LogInFormValid();
          });
          $(document).on("click",".validLogin", LogInFormValid );


        });
        function LogInUser() {
      const userLog = {
          email: $("#LoginEmail").val(), // שליפת המייל מהשדה המתאים
          password: $("#LogInPassword").val() // שליפת הסיסמה מהשדה המתאים
          };
          const api = "https://proj.ruppin.ac.il/igroup9/test2/tar1/api/Users/LogInUser";
          ajaxCall("POST",api,JSON.stringify(userLog),LogInUserSCB,LogInUserECB);
        }
        function LogInUserSCB(status) {
          console.log(status);
          alert(status);
          $("#loginForm")[0].reset();
   
          Swal.fire({
                icon: "success",
                title: "Login successful!",
                text: "Redirecting to the main page...",
                timer: 2000, 
                showConfirmButton: false})

         // הפניה לדף הראשי
         window.location.href = "https://proj.ruppin.ac.il/igroup9/test2/tar2/client%20side%20Hw1/Pages/index.html";        }


        function LogInUserECB(err) {
          console.error(err);
          alert(err);
          //"There is a problem to LogIn, please cheack your information"
        }


        function LogInFormValid() {
 
    var email = $("#LoginEmail").val();
    var password = $("#LogInPassword").val();
   
    var emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
    var passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/;
    
    if (!email) {
        swal.fire({
            icon: "error",
            title: "Email is required!",
        });
        return ;
    }
    else if (!emailRegex.test(email)) {
        swal.fire({
            icon: "error",
            title: "Invalid email format!",
        });
        return ;
    }
    
    else if (!password) {
        swal.fire({
            icon: "error",
            title: "Password is required!",
        });
        return ;
    }
    else if   (!passwordRegex.test(password)) {
        swal.fire({
            icon: "error",
            title: "Invalid password!",
            text: "Password must contain at least one uppercase letter, one digit, and be at least 8 characters long.",
        });
        return ;
    }
    else{ LogInUser();}         
        
      
      }
    </script>
  </head>
  <body>
    <div class="form-container">
      <h1>LogIn</h1>
      <form id="LogInForm">
        <label for="email">Email</label>
        <input id="LoginEmail" type="email" placeholder="Enter your email">
        <label for="password">Password</label>
        <input id="LogInPassword" type="password" placeholder="Enter your password">
        <button type="button" class ="validLogin">Login</button>
    </form>
  </body>
</html>
