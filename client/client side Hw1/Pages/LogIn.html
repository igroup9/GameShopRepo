<!DOCTYPE html>
<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="../Css/Form.css" />
    <script>
        $(document).ready(function () {
          $("#LoginForm").submit(function (e) {
            e.preventDefault();
            if (ValidLoginForm) {
              LoginUser();
            }
          });
        });

        function LoginUser() {
      const userLog = {
          Email: $("#LoginEmail").val(), // שליפת המייל מהשדה המתאים
          Password: $("#LoginPassword").val(), // שליפת הסיסמה מהשדה המתאים
          };

          const api = `https://proj.ruppin.ac.il/igroup9/test2/tar1/api/Users/LogInUser`;

          ajaxCall(
            "POST",
            api,
            JSON.stringify(userLog),
            LoginUserSCB,
            LoginUserECB
          );
        }

        function LoginUserSCB(status) {
          console.log(status);
          alert(response.message);
          $("#loginForm")[0].reset();

        }
        function LoginUserECB(err) {
          console.error(err);
          alert("There is a problem to Login, please cheack your information");
        }
        function ValidLoginForm() {
 
    var email = $("#LoginEmail").val();
    var password = $("#LoginPassword").val();

   
    var emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
    var passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/;

    
    if (!email) {
        swal.fire({
            icon: "error",
            title: "Email is required!",
        });
        return;
    }
    if (!emailRegex.test(email)) {
        swal.fire({
            icon: "error",
            title: "Invalid email format!",
        });
        return;
    }

    
    if (!password) {
        swal.fire({
            icon: "error",
            title: "Password is required!",
        });
        return;
    }
    if (!passwordRegex.test(password)) {
        swal.fire({
            icon: "error",
            title: "Invalid password!",
            text: "Password must contain at least one uppercase letter, one digit, and be at least 8 characters long.",
        });
        return;
    }

 
    Swal.fire({
        icon: "success",
        title: "Login successful!",
        text: "Redirecting to the main page...",
        timer: 2000, 
        showConfirmButton: false
    }).then(() => {
        // הפניה לדף הראשי
        window.location.href = "https://proj.ruppin.ac.il/igroup9/test2/tar2/client%20side%20Hw1/Pages/index.html";
    });
}

    </script>
  </head>
  <body>
    <div class="form-container">
      <h1>Login</h1>
      <form id="LoginForm">
        <label for="email">Email</label>
        <input id="LoginEmail" type="email" placeholder="Enter your email">
        <label for="password">Password</label>
        <input id="LoginPassword" type="password" placeholder="Enter your password">
        <button type="button" onclick="ValidLoginForm">Login</button>

    </form>
  </body>
</html>
